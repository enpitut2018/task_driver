branches:
  only:
    - master

language: ruby

rvm:
  - 2.3.3

services:
  - postgresql

before_install:
  - gem install bundler

bundler_args: "--without development --jobs=3"

cache: bundler

before_script:
  - psql -c 'create database travis_ci_test;' -U postgres
  - cp config/database.travis.yml config/database.yml
  - bundle exec rails db:create
  - bundle exec rails db:migrate

script:
  - bundle exec rails test

deploy:
  provider: heroku
  api_key:
    secure: i36bS5fu6oIZkztoJ5ieFWEDAOw+nvwRXTnxHM9zmuyJEC5JX4hgWv/iLkHmLRL8Bvq5LunKV1MFXivVT65ItsjiA8jFkqHkKwAVXEMG4tX6JvV7ou57n7hUvB0/5nYj3btVoIBeYKzjN4Y4QM+26Fqmhur3KNnvJzB1SWXUMa85aRwxHQ6PJOHh53O9drTPBxYA1xFU0k0mtE1sxhf9HxMsoylmAlV9RsYcHn+KYNsU29DCIhXjsjUxiNgKKGUAQXvy4c8iGHeBK9ijzj6FRn61KKnOVrR3NsbwKisvQATypkI+Zu/9H9avF1IYl9hdNle5oBABPgRLWdCVauhWbQX92U9xq1Gj4PfLSTtcyUON8A4D4bhNRkugCzkJH+DCsFUWlRv0OnHuUWavbvI7BibyU8T3auWuCYe71djTOoQxGMXSQsL4D0rXsuiOR5QFS9KlctyEod8AO76qPmdjXQJ+iQ1Dhx1kHS//pSpwm8ilNPubzvayE2QbiLGHYsNnJODg1AZ8wVpPqIpGnG9euKs+/f9GUs18ElyAFOYtBV9i/pGcYlOoRxNx2Q+16XSLuzdSAitTn83yFi8VFK535tAGKkojKn0NKYNJ33bV0cb0jd6q1bshzdxj/AV6xjNo9Iv83bQupESNDUMEkrdtkjO9FWt3TTRtveZMN8yqjCc=
  app: task-driver
  on:
    repo: enpitut2018/task_driver

notifications:
  slack:
    secure: Re4pUkKvjvo7ignEHFi7lnIXI5SqdwnHqLCvJHA8Rc5fOZHJqKhh4ow9CmWoFqOdBLZ6TLzoh61zYgBGqLnI07PkVLY1lrs67v/Jjx2I6p6d0RMn2X2v2ofC2vCiTGfPmY/8jgl1Z8BuK86+LE18MVTr/3nhMBr+cXu5D5yemQfbP/kgXBD1RBeKMUYM2Avxwh2YVdZIQqFGvzl74YWbRvuwbtFssYlhvWUAgYAFvtxL5oQmq+Lztk36TvvG/OiZYD4DHu1542qp/0jaWApr0RyB57LxI9o6nxHnk+R7r+CIMmv4INW211PTPAnA9HitgP3dUQkpLJLzNhRn3mopTPBHkWb1HGMKh1+Tf2cLt6PnYOwc4dpF86X8HjOMCMNwns9fuy2vgxEPBUIIDTCWOGEdEzCxAY0ACptaP6oqUAiwKjbrIqs2eHnQNQeKCRqsp7u4quAws/u61Z7RZCWO3zmbvnv5xoWQrQcBPk51whNYazAkvxKhKxmE8eAGFii+gFwG2cfltc2QVeCh9V4hJk/b6q1+vZ2Uw6niJOtkV5F7f1H6G+VOrMId9sZ3/mlzLUl4LyN2moQmLdnSEsSztwKhclkTslUESuOdFVVQs0IqhtjdxOJu0PRFEIlI04d7tQt5PBMZEIxTYYUglP2KNoLetDXAMpXRtpD9MzPpt30=